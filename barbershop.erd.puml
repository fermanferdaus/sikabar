@startuml
!theme materia

skinparam defaultFontName "Consolas"
skinparam defaultFontSize 30
skinparam entity {
  FontSize 30
  FontName "Consolas"
  BackgroundColor #FFFFFF
  BorderColor #555555
}
skinparam note {
  FontSize 30
}


entity "users" as users {
  *id_user : INT <<PK>>
  --
  nama_user : VARCHAR(100)
  username : VARCHAR(50)
  password : VARCHAR(255)
  role : ENUM('admin','kasir','capster')
  id_store : INT <<FK>>
  id_capster : INT <<FK>>
  created_at : DATETIME
}

entity "store" as store {
  *id_store : INT <<PK>>
  --
  nama_store : VARCHAR(100)
  alamat_store : TEXT
  created_at : DATETIME
}

entity "capster" as capster {
  *id_capster : INT <<PK>>
  --
  nama_capster : VARCHAR(100)
  id_store : INT <<FK>>
  status : ENUM('aktif','nonaktif')
  created_at : DATETIME
}

entity "komisi_setting" as komisi_setting {
  *id_setting : INT <<PK>>
  --
  id_store : INT <<FK>>
  persentase_capster : DECIMAL(5,2)
  updated_at : DATETIME
}

entity "pricelist" as pricelist {
  *id_pricelist : INT <<PK>>
  --
  service : VARCHAR(100)
  keterangan : TEXT
  harga : DECIMAL(12,2)
  created_at : DATETIME
}

entity "produk" as produk {
  *id_produk : INT <<PK>>
  --
  nama_produk : VARCHAR(100)
  harga_awal : DECIMAL(12,2)
  harga_jual : DECIMAL(12,2)
  created_at : DATETIME
}

entity "stok_produk" as stok_produk {
  *id_stok : INT <<PK>>
  --
  id_produk : INT <<FK>>
  id_store : INT <<FK>>
  jumlah_stok : INT
  updated_at : DATETIME
}

entity "transaksi" as transaksi {
  *id_transaksi : INT <<PK>>
  --
  id_store : INT <<FK>>
  id_user : INT <<FK>>
  tipe_transaksi : ENUM('service','produk','campuran')
  subtotal : DECIMAL(12,2)
  jumlah_bayar : DECIMAL(12,2)
  kembalian : DECIMAL(12,2)
  created_at : DATETIME
}

entity "transaksi_service_detail" as transaksi_service_detail {
  *id_detail : INT <<PK>>
  --
  id_transaksi : INT <<FK>>
  id_pricelist : INT <<FK>>
  id_capster : INT <<FK>>
  harga : DECIMAL(12,2)
  komisi_capster : DECIMAL(12,2)
  created_at : DATETIME
}

entity "transaksi_produk_detail" as transaksi_produk_detail {
  *id_detail : INT <<PK>>
  --
  id_transaksi : INT <<FK>>
  id_produk : INT <<FK>>
  jumlah : INT
  harga_awal : DECIMAL(12,2)
  harga_jual : DECIMAL(12,2)
  total_penjualan : DECIMAL(12,2)
  total_modal : DECIMAL(12,2)
  laba_rugi : DECIMAL(12,2)
  created_at : DATETIME
}

entity "struk" as struk {
  *id_struk : INT <<PK>>
  --
  id_transaksi : INT <<FK>>
  nomor_struk : VARCHAR(30)
  file_path : VARCHAR(255)
  created_at : DATETIME
}

'============================
' RELATIONSHIPS
'============================

store ||--o{ capster : "memiliki"
store ||--o{ komisi_setting : "aturan komisi"
store ||--o{ stok_produk : "memiliki stok"
store ||--o{ transaksi : "melayani transaksi"

users ||--o{ transaksi : "dicatat oleh"
users ||--|| store : "bekerja di"
users ||--|| capster : "terkait dengan"

produk ||--o{ stok_produk : "tersedia di"
produk ||--o{ transaksi_produk_detail : "terjual melalui"

pricelist ||--o{ transaksi_service_detail : "dipakai dalam"
capster ||--o{ transaksi_service_detail : "melayani"

transaksi ||--o{ transaksi_service_detail : "memiliki detail service"
transaksi ||--o{ transaksi_produk_detail : "memiliki detail produk"
transaksi ||--|| struk : "memiliki 1 struk"

@enduml
