import express from "express";
import {
  getAllProduk,
  getProdukById,
  createProduk,
  updateProduk,
  deleteProduk,
  getStokPerStore,
  getProdukByStore,
  addStokProduk,
  getStokByStoreAndProduk,
  updateStokProduk,
  deleteStokProduk,
  addProdukByKasir,
} from "../controllers/produk.controller.js";

import { verifyToken } from "../middlewares/auth.middleware.js";
import { isAdmin } from "../middlewares/role.middleware.js";

const router = express.Router();

/* =======================================================
   ðŸ§¾ RUTE KHUSUS KASIR (Tambah/Edit Produk di Tokonya)
   ======================================================= */

// ðŸ”¸ Tambah produk + stok baru (kasir)
router.post("/kasir/add", verifyToken, addProdukByKasir);

// ðŸ”¸ Update stok produk di tokonya sendiri
router.put("/kasir/update", verifyToken, updateStokProduk);

// ðŸ”¸ Hapus stok produk di tokonya sendiri
router.delete(
  "/kasir/delete/:id_store/:id_produk",
  verifyToken,
  deleteStokProduk
);

/* =======================================================
   ðŸ“¦ RUTE STOK PRODUK PER STORE
   ======================================================= */

// ðŸ”¹ Ambil stok 1 produk di store (kasir & admin)
router.get("/stok/:id_store/:id_produk", verifyToken, getStokByStoreAndProduk);

// ðŸ”¹ Update stok produk di store (admin & kasir)
router.post("/stok/update", verifyToken, updateStokProduk);

// ðŸ”¹ Hapus stok produk di toko tertentu (admin & kasir)
router.delete("/stok/:id_store/:id_produk", verifyToken, deleteStokProduk);

// ðŸ”¹ Rekap total stok semua store (admin only)
router.get("/stok", verifyToken, isAdmin, getStokPerStore);

// ðŸ”¹ Ambil daftar produk & stok per store (kasir & admin)
router.get("/stok/:id_store", verifyToken, getProdukByStore);

// ðŸ”¹ Tambah stok produk ke toko tertentu (admin & kasir)
router.post("/stok", verifyToken, addStokProduk);

/* =======================================================
   ðŸ›’ RUTE PRODUK UTAMA
   ======================================================= */

// ðŸ”¹ Ambil semua produk (admin bisa lihat semua)
router.get("/", verifyToken, getAllProduk);

// ðŸ”¹ Ambil produk berdasarkan ID
router.get("/:id", verifyToken, getProdukById);

// ðŸ”¹ Tambah produk baru (admin only)
router.post("/", verifyToken, isAdmin, createProduk);

// ðŸ”¹ Update produk (admin only)
router.put("/:id", verifyToken, isAdmin, updateProduk);

// ðŸ”¹ Hapus produk (admin only)
router.delete("/:id", verifyToken, isAdmin, deleteProduk);

export default router;
